# Описание

## Настройка базы данных

Заходим в mysql под root (или другим пользователем, у которого есть соответствующие права) и выполняем следующую последовательность действий.
Названия базы, юзер и пароль даны для примера. В случае их изменения нужно будет внести соответствующие правки в конфиг (п.1)

Создаем базу данных 1test:\
`CREATE DATABASE 1test;`

Создаем пользователя 1test:\
`CREATE USER '1test'@'localhost' IDENTIFIED BY '1test';`

Даем ему права на базу 1test:\
`GRANT ALL PRIVILEGES ON 1test.* TO '1test'@'localhost';`

Применяем права:\
`FLUSH PRIVILEGES;`

## Настройка конфига

В директории config/ есть пример конфига config.json.example, чтобы напрямую в гите не хранить авторизационные данные к базе данным, другим хранилищам или сторонним API.

Если вы использовали дефолтные команды из п.0, то нам достаточно просто скопировать файл config.json.example и переименовать его копию в config.json
Если нет, тогда нужно внести соответствующие изменения в файл config.json

## Установка зависимостей

Для того, чтобы установить зависимости, в директории проекта выполните команду:\
`npm i`

## Загрузка дампа базы данных

Для облегчения тестирования в репозитории имеется некое подобие командного интерфейса (cli.js)

Чтобы загрузить данные в базу данных достаточно ввести в терминале в папке проекта\
`node cli sql quick`

Также есть отдельные команды:

удаление таблиц\
`node cli sql drop`

создание таблиц\
`node cli sql sync`

вставка данных\
`node cli sql seed <books_count> <authors_count>`

Команда расположены в директории commands

## Тестирование проекта

Для тестирования проекта нужно в терминале запустить веб-сервер с помощью команды\
`npm start`

После этого в другой вкладке терминала\
`npm test`

Обращаю внимание на 2 момента:\
-Один из тестов проверяет "устаривание" кеша. При дефолтных настройках это длится около 5сек.\
-При тестировании содержимое таблиц с данными очищается (Тесты естественно не должны запускаться на продакшн базе). После тестирования можно воспользоваться командой sql seed для вставки данных, если это необходимо.\

Также API можно протестировать и в ручном режиме. Например, через curl для дефолтной конфигурации:\
`curl -X GET 'http://localhost:3000/books?limit=100&offset=0&order=title'`

## Структура проекта

app.js - основной файл приложения\
cli.js - "командный" интерфейс\
commands/ - команды\
config/ - конфигурация приложения\
controllers/ - контроллеры\
models/ - модели для взаимодействия с базой данных\
routes/ - роутинг\
services/ - сервисы (пул коннектов к базе данных, кеш и др.)\
tests/ - юнит и интеграционные тесты (для работы интеграционных тестов должен быть запущен инстанс приложения)
